<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BID System - Government Issuer Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-body: #0b0c15;
            --bg-panel: #151621;
            --bg-card: #1c1d2e;
            --primary: #3b82f6;
            /* Electric Blue */
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent: #06b6d4;
            /* Cyan */
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --border: #2d2f45;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            display: grid;
            grid-template-columns: 280px 1fr;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            height: 100vh;
            position: sticky;
            top: 0;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            padding: 12px 16px;
            border-radius: 12px;
            color: var(--text-muted);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
        }

        .nav-item.active,
        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        .wallet-status-card {
            margin-top: auto;
            background: var(--bg-card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .wallet-status-card h4 {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 10px;
            letter-spacing: 0.05em;
        }

        /* Main Content */
        .main-content {
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 1400px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .page-title p {
            color: var(--text-muted);
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 30px;
        }

        /* Cards */
        .card {
            background: var(--bg-panel);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
            transform: translateY(-2px);
        }

        .card-header {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 16px;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            font-size: 1rem;
        }

        .btn:hover {
            background: #2563eb;
            box-shadow: 0 0 20px var(--primary-glow);
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
        }

        .btn-outline:hover {
            border-color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
            transform: none;
            box-shadow: none;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
            width: auto;
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .btn-danger:hover {
            background: var(--error);
            color: white;
        }

        /* Status Badges & Toasts */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-badge.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-badge.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .status-badge.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        #transaction-status {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .status-toast {
            background: var(--bg-panel);
            padding: 16px 24px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            max-width: 400px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Utility */
        .flex-row {
            display: flex;
            gap: 10px;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .text-sm {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            color: var(--accent);
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            body {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            /* Simplified for this demo, would normally be a drawer */
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
            GovBID Portal
        </div>

        <div class="nav-menu">
            <div class="nav-item active">
                <span>Dashboard</span>
            </div>
            <div class="nav-item">
                <span>Registry</span>
            </div>
            <div class="nav-item">
                <span>Settings</span>
            </div>
        </div>

        <div class="wallet-status-card">
            <h4>System Status</h4>
            <div id="wallet-status" style="margin-bottom: 10px; font-size: 0.9rem;">
                Looking for wallet...
            </div>
            <div id="wallet-info" style="display: none;">
                <div style="font-size: 0.8rem; color: var(--text-muted);">Balance</div>
                <div style="font-size: 1.1rem; font-weight: 700; margin-bottom: 5px;">
                    <span id="account-balance">0.00</span> MATIC
                </div>
                <div class="status-badge success" style="width: 100%; justify-content: center;">
                    <span id="network-name">Network</span>
                </div>
            </div>
            <button class="btn btn-sm btn-outline mt-4" onclick="connectWallet()" style="width:100%">Connect
                Wallet</button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="top-bar">
            <div class="page-title">
                <h1>Issuer Dashboard</h1>
                <p>Manage government-issued blockchain identities</p>
            </div>
            <div>
                <span class="status-badge success" style="padding: 10px 20px;">Authorized Issuer Access</span>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Left Column: Primary Action -->
            <div style="display: flex; flex-direction: column; gap: 30px;">

                <!-- Issue Identity Card -->
                <div class="card">
                    <div class="card-header">
                        <h3>Issue New Digital Identity</h3>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Citizen Wallet Address</label>
                        <input type="text" class="form-input" id="user-address" placeholder="0x...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Personal Identity Data</label>
                        <input type="text" class="form-input" id="personal-info"
                            placeholder="Full Name | ID Number | DOB">
                        <div class="text-sm mt-4">Data is hashed (SHA-256) before on-chain storage. Raw data is never
                            exposed.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Supporting Document Hash (IPFS)</label>
                        <input type="text" class="form-input" id="metadata-hash" placeholder="QmHash...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">User Age (for ZKP commitment)</label>
                        <input type="number" class="form-input" id="user-age" placeholder="Age" min="1" max="150">
                        <div class="text-sm mt-4">Age is hashed with a secret nonce for zero-knowledge proofs.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Secret Nonce (auto-generated)</label>
                        <input type="text" class="form-input" id="age-nonce" readonly>
                        <button class="btn btn-sm btn-outline mt-4" style="width: auto;"
                            onclick="generateNonce()">Generate Nonce</button>
                        <div class="text-sm mt-4" style="color: var(--warning);">⚠️ User must save this nonce! They'll
                            need it to prove their age later.</div>
                    </div>

                    <div id="gas-estimation"
                        style="display: none; background: rgba(16, 185, 129, 0.1); color: var(--success); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                        <strong>Estimated Gas:</strong> <span id="gas-cost"></span> MATIC
                    </div>

                    <div class="flex-row">
                        <button class="btn btn-outline" onclick="estimateGas()">Estimate Gas</button>
                        <button class="btn" onclick="issueBID()" id="issue-btn">
                            Issue Identity Certificate
                        </button>
                    </div>

                    <div class="mt-4"
                        style="background: var(--bg-card); padding: 15px; border-radius: 12px; border: 1px dashed var(--border);">
                        <div class="form-label" style="margin-bottom: 10px;">Quick Test Data</div>
                        <div class="flex-row">
                            <button class="btn btn-sm btn-outline"
                                onclick="fillDemoData('0x742d35Cc6634C0532925a3b8D5dFcDaEec7BEA50', 'Alice Smith|USA-12345678')">Alice</button>
                            <button class="btn btn-sm btn-outline"
                                onclick="fillDemoData('0x8ba1f109551bD432803012645Ac136c7136BB53F', 'Bob Jones|UK-87654321')">Bob</button>
                        </div>
                    </div>
                </div>

                <!-- Admin Tools -->
                <div class="card">
                    <div class="card-header">
                        <h3>Administration</h3>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Authorize New Department Wrapper</label>
                        <div class="flex-row">
                            <input type="text" class="form-input" id="new-issuer" placeholder="Dept Wallet 0x...">
                            <button class="btn btn-outline" style="width: auto;" onclick="addIssuer()">Add</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column: Status & Checks -->
            <div style="display: flex; flex-direction: column; gap: 30px;">

                <!-- Contract Connectivity -->
                <div class="card">
                    <div class="card-header">
                        <h3>Contract Connection</h3>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" id="contract-address"
                            placeholder="Contract Address 0x...">
                    </div>
                    <div class="flex-row">
                        <button class="btn btn-sm btn-outline" onclick="loadContract()">Connect</button>
                        <button class="btn btn-sm btn-outline" onclick="loadFromFile()">Auto-Load</button>
                    </div>

                    <div id="contract-info"
                        style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <div class="form-label">Status</div>
                        <div class="text-sm" style="margin-bottom: 15px;">
                            <span id="contract-status" style="color: var(--success)">Connected</span>
                        </div>
                        <div class="form-label">Your Role</div>
                        <div class="text-sm">
                            Owner: <span id="is-owner" style="color: white;">-</span><br>
                            Issuer: <span id="is-issuer" style="color: white;">-</span>
                        </div>
                        <div
                            style="margin-top: 10px; font-size: 0.8rem; word-break: break-all; color: var(--text-muted);">
                            <span id="connected-address"></span>
                        </div>
                    </div>
                </div>

                <!-- Checker -->
                <div class="card">
                    <div class="card-header">
                        <h3>Identity Checker</h3>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" id="check-address" placeholder="Check Wallet 0x...">
                    </div>
                    <button class="btn btn-outline" onclick="checkVerification()">Check Status</button>

                    <div id="verification-result" style="margin-top: 20px;"></div>

                    <button onclick="revokeBID()" id="revoke-btn" class="btn btn-danger mt-4"
                        style="display: none;">Revoke Identity</button>
                    <button onclick="reEnableBID()" id="reenable-btn" class="btn mt-4"
                        style="display: none; background: var(--success);">Re-enable Identity</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div id="transaction-status"></div>

    <script>
        // Contract ABI - UPDATED for new contract
        const CONTRACT_ABI = [
            "function issueBID(address user, bytes32 hashedPersonalInfo, string memory metadataHash, bytes32 ageCommitment) external",
            "function isBIDValid(address user) external view returns (bool)",
            "function getBID(address user) external view returns (tuple(bytes32 hashedPersonalInfo, address issuer, uint256 timestamp, bool isValid, string metadataHash, bytes32 ageCommitment, uint256 revocationTimestamp))",
            "function owner() external view returns (address)",
            "function authorizedIssuers(address) external view returns (bool)",
            "function addAuthorizedIssuer(address issuer) external",
            "function revokeBID(address user) external",
            "function reEnableBID(address user) external",
            "event BIDIssued(address indexed user, address indexed issuer, bytes32 hashedPersonalInfo, string metadataHash, uint256 timestamp)",
            "event BIDRevoked(address indexed user, address indexed revokedBy, uint256 timestamp)",
            "event BIDReEnabled(address indexed user, address indexed enabledBy, uint256 timestamp)"
        ];

        let provider;
        let signer;
        let contract;
        let userAccount;

        // Custom Toast Notification System
        function showStatus(message, type) {
            const container = document.getElementById('transaction-status');
            const toast = document.createElement('div');
            toast.className = 'status-toast';

            let color = 'var(--primary)';
            if (type === 'success') color = 'var(--success)';
            if (type === 'error') color = 'var(--error)';
            if (type === 'warning') color = 'var(--warning)';

            toast.style.borderLeftColor = color;
            toast.innerHTML = `<div style="font-weight:600; color:${color}; margin-bottom:4px; text-transform:uppercase; font-size:0.8rem;">${type}</div><div>${message}</div>`;

            container.appendChild(toast);

            // Remove after 5 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        async function loadFromFile() {
            try {
                const response = await fetch('./contract-info.json');
                const contractInfo = await response.json();
                document.getElementById('contract-address').value = contractInfo.contractAddress;
                showStatus('Deployment config found', 'success');
                await loadContract();
            } catch (error) {
                showStatus('No deployment file found', 'warning');
            }
        }

        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = await provider.getSigner();
                    userAccount = await signer.getAddress();

                    const network = await provider.getNetwork();
                    const balance = await provider.getBalance(userAccount);

                    document.getElementById('wallet-status').innerHTML = 'Connected';
                    document.getElementById('wallet-status').style.color = 'var(--success)';
                    document.getElementById('account-balance').innerText = Number(ethers.formatEther(balance)).toFixed(4);
                    document.getElementById('network-name').innerText = network.name;
                    document.getElementById('wallet-info').style.display = 'block';

                    // Auto switch logic omitted for brevity, assuming user knows content
                    await loadFromFile();
                } else {
                    showStatus('MetaMask not installed', 'error');
                }
            } catch (error) {
                console.error(error);
                showStatus('Connection failed: ' + error.message, 'error');
            }
        }

        async function loadContract() {
            try {
                const address = document.getElementById('contract-address').value;
                if (!address) return;

                contract = new ethers.Contract(address, CONTRACT_ABI, signer);

                const owner = await contract.owner();
                const isOwner = userAccount.toLowerCase() === owner.toLowerCase();
                const isAuthorized = await contract.authorizedIssuers(userAccount);

                document.getElementById('contract-info').style.display = 'block';
                document.getElementById('contract-status').innerText = 'Active';
                document.getElementById('is-owner').innerText = isOwner ? 'Yes' : 'No';
                document.getElementById('is-issuer').innerText = isAuthorized ? 'Yes' : 'No';
                document.getElementById('connected-address').innerText = address;

                if (!isAuthorized) showStatus('You are not authorized to issue!', 'warning');
                else showStatus('System Ready. Authorized Access.', 'success');

            } catch (e) {
                showStatus('Failed to load contract', 'error');
            }
        }

        function generateNonce() {
            const nonce = ethers.hexlify(ethers.randomBytes(32));
            document.getElementById('age-nonce').value = nonce;
            showStatus('Nonce generated! Make sure user saves this.', 'success');
        }

        async function estimateGas() {
            if (!contract) return showStatus('Connect contract first', 'error');
            try {
                const user = document.getElementById('user-address').value;
                const info = document.getElementById('personal-info').value;
                const meta = document.getElementById('metadata-hash').value || "QmDefault";
                const age = document.getElementById('user-age').value;
                const nonce = document.getElementById('age-nonce').value;

                if (!user || !info) return showStatus('Missing fields', 'error');
                if (!age || !nonce) return showStatus('Generate age commitment first', 'error');

                const hash = ethers.keccak256(ethers.toUtf8Bytes(info));
                const ageCommitment = ethers.keccak256(ethers.solidityPacked(["uint256", "bytes32"], [parseInt(age), nonce]));
                const gas = await contract.issueBID.estimateGas(user, hash, meta, ageCommitment);
                const feeData = await provider.getFeeData();
                const cost = gas * (feeData.maxFeePerGas || feeData.gasPrice);

                document.getElementById('gas-cost').innerText = ethers.formatEther(cost);
                document.getElementById('gas-estimation').style.display = 'block';
            } catch (e) {
                showStatus(e.message, 'error');
            }
        }

        async function issueBID() {
            if (!contract) return showStatus('Connect contract first', 'error');
            try {
                const user = document.getElementById('user-address').value;
                const info = document.getElementById('personal-info').value;
                const meta = document.getElementById('metadata-hash').value || "QmDefault";
                const age = document.getElementById('user-age').value;
                const nonce = document.getElementById('age-nonce').value;

                if (!user || !info) return showStatus('Missing fields', 'error');
                if (!age || !nonce) return showStatus('Please enter age and generate nonce', 'error');

                showStatus('Please confirm transaction...', 'info');
                const hash = ethers.keccak256(ethers.toUtf8Bytes(info));
                const ageCommitment = ethers.keccak256(ethers.solidityPacked(["uint256", "bytes32"], [parseInt(age), nonce]));

                const tx = await contract.issueBID(user, hash, meta, ageCommitment);
                showStatus('Issuing... Waiting for confirmation', 'info');
                await tx.wait();

                showStatus(`Identity Issued! User MUST save this nonce: ${nonce}`, 'success');

                // Show nonce in alert for user to copy
                alert(`✅ BID Issued Successfully!\n\n⚠️ IMPORTANT: Give this nonce to the user:\n${nonce}\n\nThey will need it to prove their age later.`);

                document.getElementById('user-address').value = '';
                document.getElementById('personal-info').value = '';
                document.getElementById('user-age').value = '';
                document.getElementById('age-nonce').value = '';
            } catch (e) {
                showStatus(e.message, 'error');
            }
        }

        async function checkVerification() {
            if (!contract) return showStatus('Connect contract first', 'error');
            const addr = document.getElementById('check-address').value;
            if (!addr) return;

            try {
                const isValid = await contract.isBIDValid(addr);
                const div = document.getElementById('verification-result');
                const revokeBtn = document.getElementById('revoke-btn');
                const reenableBtn = document.getElementById('reenable-btn');

                if (isValid) {
                    const data = await contract.getBID(addr);
                    const timestamp = new Date(Number(data.timestamp) * 1000);

                    div.innerHTML = `
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success); padding: 15px; border-radius: 12px; color: var(--success);">
                            <strong>✓ VERIFIED CITIZEN</strong><br>
                            <span style="font-size:0.8rem; opacity:0.8">Issued: ${timestamp.toLocaleDateString()}</span><br>
                            <span style="font-size:0.8rem; opacity:0.8">Issuer: ${data.issuer.substring(0, 10)}...</span>
                        </div>
                    `;
                    revokeBtn.style.display = 'inline-flex';
                    reenableBtn.style.display = 'none';
                } else {
                    // Check if BID exists but is revoked
                    try {
                        const data = await contract.getBID(addr);
                        const revokeTime = data.revocationTimestamp > 0 ? new Date(Number(data.revocationTimestamp) * 1000) : null;

                        div.innerHTML = `
                            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); padding: 15px; border-radius: 12px; color: var(--error);">
                                <strong>⊘ REVOKED</strong><br>
                                <span style="font-size:0.8rem; opacity:0.8">Revoked: ${revokeTime ? revokeTime.toLocaleString() : 'Unknown'}</span>
                            </div>
                        `;
                        revokeBtn.style.display = 'none';
                        reenableBtn.style.display = 'inline-flex';
                    } catch {
                        div.innerHTML = `
                            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); padding: 15px; border-radius: 12px; color: var(--error);">
                                <strong>NOT VERIFIED</strong>
                            </div>
                        `;
                        revokeBtn.style.display = 'none';
                        reenableBtn.style.display = 'none';
                    }
                }
            } catch (e) {
                showStatus(e.message, 'error');
            }
        }

        async function revokeBID() {
            const addr = document.getElementById('check-address').value;
            // Logic for revocation
            try {
                const tx = await contract.revokeBID(addr);
                showStatus('Revoking...', 'info');
                await tx.wait();
                showStatus('Identity Revoked', 'success');
                checkVerification();
            } catch (e) { showStatus(e.message, 'error'); }
        }

        async function reEnableBID() {
            const addr = document.getElementById('check-address').value;
            if (!contract || !addr) return;

            try {
                showStatus('Re-enabling BID...', 'info');
                const tx = await contract.reEnableBID(addr);
                await tx.wait();
                showStatus('BID Re-enabled Successfully!', 'success');
                checkVerification(); // Refresh status
            } catch (e) {
                if (e.message.includes('Only owner')) {
                    showStatus('Only contract owner can re-enable BIDs', 'error');
                } else {
                    showStatus(e.message, 'error');
                }
            }
        }

        async function addIssuer() {
            if (!contract) return;
            try {
                const newIssuer = document.getElementById('new-issuer').value;
                const tx = await contract.addAuthorizedIssuer(newIssuer);
                showStatus('Authorizing...', 'info');
                await tx.wait();
                showStatus('New Issuer Authorized', 'success');
            } catch (e) { showStatus(e.message, 'error'); }
        }

        function fillDemoData(addr, info) {
            document.getElementById('user-address').value = addr;
            document.getElementById('personal-info').value = info;
        }
    </script>
</body>

</html>